(function(){
  const whatWidth = (item) =>{
    let reqItemWidth = 0;
  
    const windowWidth = $(window).width();
    const container = item.closest('.products-menu');
    const titles = container.find('.products-menu__title');
    const titlesWidth = titles.width() * titles.length;
  
    const contentBlock = item.find('.products-menu__content-main');
  
    const paddingLeft = parseInt(contentBlock.css("padding-left"));
    const paddingRight = parseInt(contentBlock.css("padding-right"));
   
    
    const isMobile = window.matchMedia("(max-width: 850px)").matches;
  
    if(isMobile){
      reqItemWidth = windowWidth - titlesWidth;
    } else {
      reqItemWidth = 524;
    }
  
    return {
      container: reqItemWidth,
      content: reqItemWidth - paddingLeft - paddingRight
    }
  }
  
  const closeElems = (container) =>{
    const items = container.find('.products-menu__item');
    const content = container.find('.products-menu__content');
    items.removeClass('active');
    
    content.width(0);
  }
  
  const openElem = function(item) {
    const content = item.find('.products-menu__content');
    const textBlock = item.find('.products-menu__content-main');
  
    const needWidth = whatWidth(item);
  
    item.addClass('active');
  
    content.width(needWidth.container);
    textBlock.width(needWidth.content);
  
  }
  
  $('.products-menu__title').on('click', e=>{
    e.preventDefault();
  
    const currentElem = $(e.currentTarget);
    const item = currentElem.closest('.products-menu__item');
    const openedItem = item.hasClass('active');
    const container = item.closest('.products-menu');
  
    if(openedItem){
      closeElems(container)
    } else {
      closeElems(container)
      openElem(item)
    }
  
  });

})();;(function(){
  
let myMap;
 
const init = () => {
 myMap = new ymaps.Map("map", {
   center: [55.752004, 37.576133],
   zoom: 16,
   controls: []
 });

const coords = [
     [55.752004, 37.576133],
   ],
   myCollection = new ymaps.GeoObjectCollection({}, {
     draggable: false,
     iconLayout: 'default#image',
     iconImageHref: './img/icons/geo.svg',
     iconImageSize: [58, 73],
     iconImageOffset: [-35, -52]
   });
 
 for (let i = 0; i < coords.length; i++) {
   myCollection.add(new ymaps.Placemark(coords[i]));
 }
 
 myMap.geoObjects.add(myCollection);
 
 myMap.behaviors.disable('scrollZoom');
};


 
ymaps.ready(init);

})();(function(){
const validateFields = (form, fieldsArray) => {
    
    fieldsArray.forEach((field) => {
        field.removeClass("input-error");
        if (field.val().trim() === "") {
            field.addClass("input-error");
        }
    });

    const errorFields = form.find(".input-error");

    return errorFields.length === 0;
}

$(".form").submit(e => {
    e.preventDefault();


    const form = $(e.currentTarget);
    const name = form.find("[name='name']");
    const phone = form.find("[name='phone']");
    const comment = form.find("[name='comment']");
    const to = form.find("[name='to']");


    const modal = $("#modal");
    const content = modal.find(".modal__content");

    
    modal.removeClass("error-modal");

    const isValid = validateFields(form, [name, phone, comment, to]);


    if(isValid) {
       const request = $.ajax({
            url: "https://webdev-api.loftschool.com/sendmail",
            method: "post",
            data: {
                name: name.val(),
                phone: phone.val(),
                comment: comment.val(),
                to: to.val(),              
            },
            
            error: data => {
                
            }
        });

        request.done((data) => {
            content.text(data.message);
            $('.form').trigger("reset");
        });

        request.fail((data) => {
            const message = data.responseJSON.message;
                content.text(message);
                modal.addClass("error-modal");
        });

        request.always(() => {
            $.fancybox.open({
                src: "#modal", 
                type: "inline",
             });
        })
    }
    
});


$(".app-close-modal").click(e => {
    e.preventDefault();

    $.fancybox.close();
});

})();(function(){
const sections = $("section");
const display = $(".maincontent");
const sideMenu = $(".fixed-menu");
const menuItems = sideMenu.find(".fixed-menu__item");

const mobileDetect = new MobileDetect(window.navigator.userAgent);
const isMobile = mobileDetect.mobile();

let inScroll = false;

sections.first().addClass("active");

const countSectionPosition = (sectionEq) => {
    const position = sectionEq * -100; 

    if (isNaN(position)) {
        console.error("передано не верное значение в  countSectionPosition");
        return 0;
    }

    return position;
};

const ChangeMenuThemeForSection = (sectionEq) => {

    const currentSection = sections.eq(sectionEq);
    const menuTheme = currentSection.attr("data-sidemenu-theme");
    const activeClass = "fixed-menu--shadowed";

        if(menuTheme === "black") {
            sideMenu.addClass(activeClass);
        } else {
            sideMenu.removeClass(activeClass);
        }
};

const resetActiveClassForItem = (items, itemEq, activeClass) => {
    items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
}

const performTransition = (sectionEq) => {
    if (inScroll) return;

    const transitionOver = 1000;
    const mouseInertialOver = 300;

    inScroll = true;

    const position = countSectionPosition(sectionEq);

    ChangeMenuThemeForSection(sectionEq);
        

        display.css({
        transform: `translateY(${position}%)`
    });

    resetActiveClassForItem(sections, sectionEq, "active");

    setTimeout(() => {
        inScroll = false;

        resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");

    }, transitionOver + mouseInertialOver);
};

    const viewportScroller = () => {
    const activeSection = sections.filter(".active");
    const nextSection = activeSection.next();
    const prevSection = activeSection.prev();

    return {
        next() {
            if (nextSection.length) {
                performTransition(nextSection.index());
            }
        },
        prev() {
            if (prevSection.length) {
                performTransition(prevSection.index());
            }   
        },
    };
};



$(window).on("wheel", (e) => {
    const deltaY = e.originalEvent.deltaY;
    const scroller = viewportScroller();

    if (deltaY > 0) {
        scroller.next();
    }
    if (deltaY < 0) {
        scroller.prev();
    }

    
});

$(window).on("keydown", (e) => {
    const tagName = e.target.tagName.toLowerCase();
    const userTypingInInputs = tagName === "input" || tagName === "textarea";
    const scroller = viewportScroller();

    if (userTypingInInputs) return;

        switch (e.keyCode) {
            case 38:
                scroller.prev();
                break;
    
            case 40:
                scroller.next();
                break;
    
        }
    
});



$(".wrapper").on("touchmove", e => e.preventDefault());

$("[data-scroll-to]").click((e) => {
    e.preventDefault();

    const $this = $(e.currentTarget);
    const target = $this.attr("data-scroll-to");
    const reqSection = $(`[data-section-id=${target}]`);

    performTransition(reqSection.index());
});



if (isMobile) {
    //https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
    $("body").swipe({
        swipe: function (event, direction) {
            const scroller = viewportScroller();
            let scrollDirection = "";

            if (direction === "up") scrollDirection = "next";
            if(direction === "down") scrollDirection = "prev";

            scroller[scrollDirection]();
        },
    });
}

})()





  






;(function() {
    const playBtn = document.querySelector('.video__player-img');
    const video = document.getElementById('player');
    const playerPlayBrn = document.querySelector('.duration__img');
    const durationControl = document.getElementById('durationLevel');
    const soundControl = document.getElementById('micLevel');
    const soundBtn = document.getElementById('soundBtn');
    const dynamicBtn = document.getElementById('dynamic');
    
    let intervalId; 
    let soundLevel;
    
    // video.addEventListener("loadeddata", function () {
      window.addEventListener('load', function() {
    
    video.addEventListener('click', playStop); 
    let playButtons = document.querySelectorAll('.play');
    
    for (let i = 0; i < playButtons.length; i++) {
      playButtons[i].addEventListener('click', playStop);
    }
    
    durationControl.min = 0;
    durationControl.value = 0;
    durationControl.max = video.duration;
    durationControl.addEventListener('input', setVideoDuration);
    
    soundControl.min = 0;
    soundControl.max = 10;
    soundControl.value = soundControl.max;
    soundControl.addEventListener('input', changeSoundVolume);
    
    dynamicBtn.addEventListener('click', soundOf);
    });
    
    video.addEventListener('ended', () => {
      playBtn.classList.toggle('video__player-img--active');
      playerPlayBrn.classList.remove('duration__img-pause');
      video.currentTime = 0;
    })
    
    function playStop() {
      playBtn.classList.toggle('video__player-img--active');
      playerPlayBrn.classList.toggle('duration__img-pause');
      if (video.paused) {
        video.play();
        intervalId = setInterval(updateDuration, 1000 / 60);
      } else {
        clearInterval(intervalId);
        video.pause();
      }
    }
    
    function setVideoDuration() {
      video.currentTime = durationControl.value;
      updateDuration();
    }
    
    function updateDuration() {
      durationControl.value = video.currentTime;
      let step = video.duration / 100;
      let percent = video.currentTime / step;
      durationControl.style.background = `linear-gradient(90deg, #FEDB3F 0%, #FEDB3F ${percent}%, #626262 ${percent}%)`;
    }
    
    function changeSoundVolume() {
      video.volume = soundControl.value / 10;
      if (video.volume === 0) {
        soundBtn.classList.add('active');
      } else {
        soundBtn.classList.remove('active');
      }
    }
    
    function soundOf() {
      if (video.volume === 0) {
        video.volume = soundLevel;
        soundControl.value = soundLevel * 10;
        soundBtn.classList.remove('active');
      } else {
        soundLevel = video.volume;
        video.volume = 0;
        soundControl.value = 0;
        soundBtn.classList.add('active');
      }
    }
    })();
(function(){

const findBlockByAlias = (alias) => {
  return $(".reviews__item").filter((ndx, item) => {
    return $(item).attr("data-selected") === alias; 
  });
};

$(".reviews__switcher-link").click((e) => {
  e.preventDefault();

  const $this = $(e.currentTarget);
  const target = $this.attr("data-select");
  const itemShow = findBlockByAlias(target);
  const curItem = $this.closest(".reviews__switcher-item");

  itemShow.addClass("reviews__item--active").siblings().removeClass("reviews__item--active");
  curItem.addClass("reviews__switcher-item--active").siblings().removeClass("reviews__switcher-item--active");
});


})();// простой способ
(function(){ 
let burger  = document.querySelector('.burger');
let overlay = document.querySelector('.overlay');
let body = document.querySelector('body');

let links = document.querySelectorAll('.overlay .menu__link'); [1,2,3,4,5,6,7]

links.forEach(function(element){
  element.addEventListener('click' , toggleMenu);
})

function toggleMenu(){
  burger.classList.toggle('burger--active');
  overlay.classList.toggle('overlay--active');
  body.classList.toggle('body--active-menu');
}

burger.addEventListener('click' , toggleMenu);


})()



















;
;(function(){
$(document).ready(function(){
  const slider = $(".slider__list").bxSlider({
    pager: false,
    controls: false,
  });

  $('.products__arrow--prev').click(e => {
    e.preventDefault();

    slider.goToPrevSlide();
  })
  $('.products__arrow--next').click(e => {
    e.preventDefault();

    slider.goToNextSlide();
  })
});


})()
	;(function(){ const openItem = item => {
    const container = item.closest(".team__item");
    const contentBlock = container.find(".team__content");
    const textBlock = contentBlock.find(".team__content-block");
    const reqHeight = textBlock.height();
  
    container.addClass("team__item--active");
    contentBlock.height(reqHeight);
  }
  
  
  const closeEveryItem = (container) => {
    const items = container.find('.team__content');
    const itemContainer = container.find(".team__item");
  
    itemContainer.removeClass("team__item--active");
    items.height(0);
  }
  
  $('.team__title').click(e => {
    const $this = $(e.currentTarget);
    const container = $this.closest('.team');
    const elemContainer = $this.closest(".team__item");
  
    if(elemContainer.hasClass("team__item--active")) {
      closeEveryItem(container);
    }
    else {
      closeEveryItem(container);
      openItem($this);
    }
  });
  
  
  
  
  // const trianglePosition ()
      
      
  $('.team__title').on('click', e =>{
      
    const chosenElem = $(e.currentTarget);
    const itemStore = chosenElem.closest('.team');
    const elemStore = chosenElem.closest('.team__item');
    const triangle = chosenElem.find('.team__title-svg-path');
    const triangleAll = itemStore.find('.team__title-svg-path');
  
  
  
    if(elemStore.hasClass('team__item-active')){
      closeItem(itemStore);
      triangle.attr('xlink:href', './img/icons/sprite.svg#team-triangle')
    } else{
      closeItem(itemStore);
      openItem(chosenElem);
      triangleAll.attr('xlink:href', './img/icons/sprite.svg#team-triangle');
      triangle.attr('xlink:href', './img/icons/sprite.svg#triangle-up');
  
    }
  });

})()
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImhvcml6b250YWwtYWNjby5qcyIsIm1hcC5qcyIsIm1vZGFsLmpzIiwib3BzLmpzIiwicGxheWVyLmpzIiwicmV2aWV3cy5qcyIsInNjcmlwdC5qcyIsInNsaWRlci5qcyIsInRlYW0uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxNQ25FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0NuQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxLQy9FQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsQ0N2S0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNDdEZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0N0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLENDekNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsRUN0QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigpe1xuICBjb25zdCB3aGF0V2lkdGggPSAoaXRlbSkgPT57XG4gICAgbGV0IHJlcUl0ZW1XaWR0aCA9IDA7XG4gIFxuICAgIGNvbnN0IHdpbmRvd1dpZHRoID0gJCh3aW5kb3cpLndpZHRoKCk7XG4gICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KCcucHJvZHVjdHMtbWVudScpO1xuICAgIGNvbnN0IHRpdGxlcyA9IGNvbnRhaW5lci5maW5kKCcucHJvZHVjdHMtbWVudV9fdGl0bGUnKTtcbiAgICBjb25zdCB0aXRsZXNXaWR0aCA9IHRpdGxlcy53aWR0aCgpICogdGl0bGVzLmxlbmd0aDtcbiAgXG4gICAgY29uc3QgY29udGVudEJsb2NrID0gaXRlbS5maW5kKCcucHJvZHVjdHMtbWVudV9fY29udGVudC1tYWluJyk7XG4gIFxuICAgIGNvbnN0IHBhZGRpbmdMZWZ0ID0gcGFyc2VJbnQoY29udGVudEJsb2NrLmNzcyhcInBhZGRpbmctbGVmdFwiKSk7XG4gICAgY29uc3QgcGFkZGluZ1JpZ2h0ID0gcGFyc2VJbnQoY29udGVudEJsb2NrLmNzcyhcInBhZGRpbmctcmlnaHRcIikpO1xuICAgXG4gICAgXG4gICAgY29uc3QgaXNNb2JpbGUgPSB3aW5kb3cubWF0Y2hNZWRpYShcIihtYXgtd2lkdGg6IDg1MHB4KVwiKS5tYXRjaGVzO1xuICBcbiAgICBpZihpc01vYmlsZSl7XG4gICAgICByZXFJdGVtV2lkdGggPSB3aW5kb3dXaWR0aCAtIHRpdGxlc1dpZHRoO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXFJdGVtV2lkdGggPSA1MjQ7XG4gICAgfVxuICBcbiAgICByZXR1cm4ge1xuICAgICAgY29udGFpbmVyOiByZXFJdGVtV2lkdGgsXG4gICAgICBjb250ZW50OiByZXFJdGVtV2lkdGggLSBwYWRkaW5nTGVmdCAtIHBhZGRpbmdSaWdodFxuICAgIH1cbiAgfVxuICBcbiAgY29uc3QgY2xvc2VFbGVtcyA9IChjb250YWluZXIpID0+e1xuICAgIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoJy5wcm9kdWN0cy1tZW51X19pdGVtJyk7XG4gICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kKCcucHJvZHVjdHMtbWVudV9fY29udGVudCcpO1xuICAgIGl0ZW1zLnJlbW92ZUNsYXNzKCdhY3RpdmUnKTtcbiAgICBcbiAgICBjb250ZW50LndpZHRoKDApO1xuICB9XG4gIFxuICBjb25zdCBvcGVuRWxlbSA9IGZ1bmN0aW9uKGl0ZW0pIHtcbiAgICBjb25zdCBjb250ZW50ID0gaXRlbS5maW5kKCcucHJvZHVjdHMtbWVudV9fY29udGVudCcpO1xuICAgIGNvbnN0IHRleHRCbG9jayA9IGl0ZW0uZmluZCgnLnByb2R1Y3RzLW1lbnVfX2NvbnRlbnQtbWFpbicpO1xuICBcbiAgICBjb25zdCBuZWVkV2lkdGggPSB3aGF0V2lkdGgoaXRlbSk7XG4gIFxuICAgIGl0ZW0uYWRkQ2xhc3MoJ2FjdGl2ZScpO1xuICBcbiAgICBjb250ZW50LndpZHRoKG5lZWRXaWR0aC5jb250YWluZXIpO1xuICAgIHRleHRCbG9jay53aWR0aChuZWVkV2lkdGguY29udGVudCk7XG4gIFxuICB9XG4gIFxuICAkKCcucHJvZHVjdHMtbWVudV9fdGl0bGUnKS5vbignY2xpY2snLCBlPT57XG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBcbiAgICBjb25zdCBjdXJyZW50RWxlbSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcbiAgICBjb25zdCBpdGVtID0gY3VycmVudEVsZW0uY2xvc2VzdCgnLnByb2R1Y3RzLW1lbnVfX2l0ZW0nKTtcbiAgICBjb25zdCBvcGVuZWRJdGVtID0gaXRlbS5oYXNDbGFzcygnYWN0aXZlJyk7XG4gICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KCcucHJvZHVjdHMtbWVudScpO1xuICBcbiAgICBpZihvcGVuZWRJdGVtKXtcbiAgICAgIGNsb3NlRWxlbXMoY29udGFpbmVyKVxuICAgIH0gZWxzZSB7XG4gICAgICBjbG9zZUVsZW1zKGNvbnRhaW5lcilcbiAgICAgIG9wZW5FbGVtKGl0ZW0pXG4gICAgfVxuICBcbiAgfSk7XG5cbn0pKCk7IiwiKGZ1bmN0aW9uKCl7XHJcbiAgXHJcbmxldCBteU1hcDtcclxuIFxyXG5jb25zdCBpbml0ID0gKCkgPT4ge1xyXG4gbXlNYXAgPSBuZXcgeW1hcHMuTWFwKFwibWFwXCIsIHtcclxuICAgY2VudGVyOiBbNTUuNzUyMDA0LCAzNy41NzYxMzNdLFxyXG4gICB6b29tOiAxNixcclxuICAgY29udHJvbHM6IFtdXHJcbiB9KTtcclxuXHJcbmNvbnN0IGNvb3JkcyA9IFtcclxuICAgICBbNTUuNzUyMDA0LCAzNy41NzYxMzNdLFxyXG4gICBdLFxyXG4gICBteUNvbGxlY3Rpb24gPSBuZXcgeW1hcHMuR2VvT2JqZWN0Q29sbGVjdGlvbih7fSwge1xyXG4gICAgIGRyYWdnYWJsZTogZmFsc2UsXHJcbiAgICAgaWNvbkxheW91dDogJ2RlZmF1bHQjaW1hZ2UnLFxyXG4gICAgIGljb25JbWFnZUhyZWY6ICcuL2ltZy9pY29ucy9nZW8uc3ZnJyxcclxuICAgICBpY29uSW1hZ2VTaXplOiBbNTgsIDczXSxcclxuICAgICBpY29uSW1hZ2VPZmZzZXQ6IFstMzUsIC01Ml1cclxuICAgfSk7XHJcbiBcclxuIGZvciAobGV0IGkgPSAwOyBpIDwgY29vcmRzLmxlbmd0aDsgaSsrKSB7XHJcbiAgIG15Q29sbGVjdGlvbi5hZGQobmV3IHltYXBzLlBsYWNlbWFyayhjb29yZHNbaV0pKTtcclxuIH1cclxuIFxyXG4gbXlNYXAuZ2VvT2JqZWN0cy5hZGQobXlDb2xsZWN0aW9uKTtcclxuIFxyXG4gbXlNYXAuYmVoYXZpb3JzLmRpc2FibGUoJ3Njcm9sbFpvb20nKTtcclxufTtcclxuXHJcblxyXG4gXHJcbnltYXBzLnJlYWR5KGluaXQpO1xyXG5cclxufSkoKSIsIihmdW5jdGlvbigpe1xyXG5jb25zdCB2YWxpZGF0ZUZpZWxkcyA9IChmb3JtLCBmaWVsZHNBcnJheSkgPT4ge1xyXG4gICAgXHJcbiAgICBmaWVsZHNBcnJheS5mb3JFYWNoKChmaWVsZCkgPT4ge1xyXG4gICAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICAgICAgaWYgKGZpZWxkLnZhbCgpLnRyaW0oKSA9PT0gXCJcIikge1xyXG4gICAgICAgICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuICAgIGNvbnN0IGVycm9yRmllbGRzID0gZm9ybS5maW5kKFwiLmlucHV0LWVycm9yXCIpO1xyXG5cclxuICAgIHJldHVybiBlcnJvckZpZWxkcy5sZW5ndGggPT09IDA7XHJcbn1cclxuXHJcbiQoXCIuZm9ybVwiKS5zdWJtaXQoZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG5cclxuICAgIGNvbnN0IGZvcm0gPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCBuYW1lID0gZm9ybS5maW5kKFwiW25hbWU9J25hbWUnXVwiKTtcclxuICAgIGNvbnN0IHBob25lID0gZm9ybS5maW5kKFwiW25hbWU9J3Bob25lJ11cIik7XHJcbiAgICBjb25zdCBjb21tZW50ID0gZm9ybS5maW5kKFwiW25hbWU9J2NvbW1lbnQnXVwiKTtcclxuICAgIGNvbnN0IHRvID0gZm9ybS5maW5kKFwiW25hbWU9J3RvJ11cIik7XHJcblxyXG5cclxuICAgIGNvbnN0IG1vZGFsID0gJChcIiNtb2RhbFwiKTtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwiLm1vZGFsX19jb250ZW50XCIpO1xyXG5cclxuICAgIFxyXG4gICAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcclxuXHJcbiAgICBjb25zdCBpc1ZhbGlkID0gdmFsaWRhdGVGaWVsZHMoZm9ybSwgW25hbWUsIHBob25lLCBjb21tZW50LCB0b10pO1xyXG5cclxuXHJcbiAgICBpZihpc1ZhbGlkKSB7XHJcbiAgICAgICBjb25zdCByZXF1ZXN0ID0gJC5hamF4KHtcclxuICAgICAgICAgICAgdXJsOiBcImh0dHBzOi8vd2ViZGV2LWFwaS5sb2Z0c2Nob29sLmNvbS9zZW5kbWFpbFwiLFxyXG4gICAgICAgICAgICBtZXRob2Q6IFwicG9zdFwiLFxyXG4gICAgICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgcGhvbmU6IHBob25lLnZhbCgpLFxyXG4gICAgICAgICAgICAgICAgY29tbWVudDogY29tbWVudC52YWwoKSxcclxuICAgICAgICAgICAgICAgIHRvOiB0by52YWwoKSwgICAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZXJyb3I6IGRhdGEgPT4ge1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5kb25lKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnRlbnQudGV4dChkYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAkKCcuZm9ybScpLnRyaWdnZXIoXCJyZXNldFwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5mYWlsKChkYXRhKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xyXG4gICAgICAgICAgICAgICAgY29udGVudC50ZXh0KG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgbW9kYWwuYWRkQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmVxdWVzdC5hbHdheXMoKCkgPT4ge1xyXG4gICAgICAgICAgICAkLmZhbmN5Ym94Lm9wZW4oe1xyXG4gICAgICAgICAgICAgICAgc3JjOiBcIiNtb2RhbFwiLCBcclxuICAgICAgICAgICAgICAgIHR5cGU6IFwiaW5saW5lXCIsXHJcbiAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9KVxyXG4gICAgfVxyXG4gICAgXHJcbn0pO1xyXG5cclxuXHJcbiQoXCIuYXBwLWNsb3NlLW1vZGFsXCIpLmNsaWNrKGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgICQuZmFuY3lib3guY2xvc2UoKTtcclxufSk7XHJcblxyXG59KSgpIiwiKGZ1bmN0aW9uKCl7XHJcbmNvbnN0IHNlY3Rpb25zID0gJChcInNlY3Rpb25cIik7XHJcbmNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG5jb25zdCBzaWRlTWVudSA9ICQoXCIuZml4ZWQtbWVudVwiKTtcclxuY29uc3QgbWVudUl0ZW1zID0gc2lkZU1lbnUuZmluZChcIi5maXhlZC1tZW51X19pdGVtXCIpO1xyXG5cclxuY29uc3QgbW9iaWxlRGV0ZWN0ID0gbmV3IE1vYmlsZURldGVjdCh3aW5kb3cubmF2aWdhdG9yLnVzZXJBZ2VudCk7XHJcbmNvbnN0IGlzTW9iaWxlID0gbW9iaWxlRGV0ZWN0Lm1vYmlsZSgpO1xyXG5cclxubGV0IGluU2Nyb2xsID0gZmFsc2U7XHJcblxyXG5zZWN0aW9ucy5maXJzdCgpLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG5cclxuY29uc3QgY291bnRTZWN0aW9uUG9zaXRpb24gPSAoc2VjdGlvbkVxKSA9PiB7XHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IHNlY3Rpb25FcSAqIC0xMDA7IFxyXG5cclxuICAgIGlmIChpc05hTihwb3NpdGlvbikpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwi0L/QtdGA0LXQtNCw0L3QviDQvdC1INCy0LXRgNC90L7QtSDQt9C90LDRh9C10L3QuNC1INCyICBjb3VudFNlY3Rpb25Qb3NpdGlvblwiKTtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gcG9zaXRpb247XHJcbn07XHJcblxyXG5jb25zdCBDaGFuZ2VNZW51VGhlbWVGb3JTZWN0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG5cclxuICAgIGNvbnN0IGN1cnJlbnRTZWN0aW9uID0gc2VjdGlvbnMuZXEoc2VjdGlvbkVxKTtcclxuICAgIGNvbnN0IG1lbnVUaGVtZSA9IGN1cnJlbnRTZWN0aW9uLmF0dHIoXCJkYXRhLXNpZGVtZW51LXRoZW1lXCIpO1xyXG4gICAgY29uc3QgYWN0aXZlQ2xhc3MgPSBcImZpeGVkLW1lbnUtLXNoYWRvd2VkXCI7XHJcblxyXG4gICAgICAgIGlmKG1lbnVUaGVtZSA9PT0gXCJibGFja1wiKSB7XHJcbiAgICAgICAgICAgIHNpZGVNZW51LmFkZENsYXNzKGFjdGl2ZUNsYXNzKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzaWRlTWVudS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICAgICAgfVxyXG59O1xyXG5cclxuY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICAgIGl0ZW1zLmVxKGl0ZW1FcSkuYWRkQ2xhc3MoYWN0aXZlQ2xhc3MpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoYWN0aXZlQ2xhc3MpO1xyXG59XHJcblxyXG5jb25zdCBwZXJmb3JtVHJhbnNpdGlvbiA9IChzZWN0aW9uRXEpID0+IHtcclxuICAgIGlmIChpblNjcm9sbCkgcmV0dXJuO1xyXG5cclxuICAgIGNvbnN0IHRyYW5zaXRpb25PdmVyID0gMTAwMDtcclxuICAgIGNvbnN0IG1vdXNlSW5lcnRpYWxPdmVyID0gMzAwO1xyXG5cclxuICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuXHJcbiAgICBjb25zdCBwb3NpdGlvbiA9IGNvdW50U2VjdGlvblBvc2l0aW9uKHNlY3Rpb25FcSk7XHJcblxyXG4gICAgQ2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbihzZWN0aW9uRXEpO1xyXG4gICAgICAgIFxyXG5cclxuICAgICAgICBkaXNwbGF5LmNzcyh7XHJcbiAgICAgICAgdHJhbnNmb3JtOiBgdHJhbnNsYXRlWSgke3Bvc2l0aW9ufSUpYFxyXG4gICAgfSk7XHJcblxyXG4gICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0oc2VjdGlvbnMsIHNlY3Rpb25FcSwgXCJhY3RpdmVcIik7XHJcblxyXG4gICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgaW5TY3JvbGwgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0obWVudUl0ZW1zLCBzZWN0aW9uRXEsIFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpO1xyXG5cclxuICAgIH0sIHRyYW5zaXRpb25PdmVyICsgbW91c2VJbmVydGlhbE92ZXIpO1xyXG59O1xyXG5cclxuICAgIGNvbnN0IHZpZXdwb3J0U2Nyb2xsZXIgPSAoKSA9PiB7XHJcbiAgICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZVwiKTtcclxuICAgIGNvbnN0IG5leHRTZWN0aW9uID0gYWN0aXZlU2VjdGlvbi5uZXh0KCk7XHJcbiAgICBjb25zdCBwcmV2U2VjdGlvbiA9IGFjdGl2ZVNlY3Rpb24ucHJldigpO1xyXG5cclxuICAgIHJldHVybiB7XHJcbiAgICAgICAgbmV4dCgpIHtcclxuICAgICAgICAgICAgaWYgKG5leHRTZWN0aW9uLmxlbmd0aCkge1xyXG4gICAgICAgICAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24obmV4dFNlY3Rpb24uaW5kZXgoKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9LFxyXG4gICAgICAgIHByZXYoKSB7XHJcbiAgICAgICAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKHByZXZTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICAgICAgICB9ICAgXHJcbiAgICAgICAgfSxcclxuICAgIH07XHJcbn07XHJcblxyXG5cclxuXHJcbiQod2luZG93KS5vbihcIndoZWVsXCIsIChlKSA9PiB7XHJcbiAgICBjb25zdCBkZWx0YVkgPSBlLm9yaWdpbmFsRXZlbnQuZGVsdGFZO1xyXG4gICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcblxyXG4gICAgaWYgKGRlbHRhWSA+IDApIHtcclxuICAgICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbiAgICB9XHJcbiAgICBpZiAoZGVsdGFZIDwgMCkge1xyXG4gICAgICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICAgIH1cclxuXHJcbiAgICBcclxufSk7XHJcblxyXG4kKHdpbmRvdykub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XHJcbiAgICBjb25zdCB0YWdOYW1lID0gZS50YXJnZXQudGFnTmFtZS50b0xvd2VyQ2FzZSgpO1xyXG4gICAgY29uc3QgdXNlclR5cGluZ0luSW5wdXRzID0gdGFnTmFtZSA9PT0gXCJpbnB1dFwiIHx8IHRhZ05hbWUgPT09IFwidGV4dGFyZWFcIjtcclxuICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG5cclxuICAgIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuXHJcbiAgICAgICAgc3dpdGNoIChlLmtleUNvZGUpIHtcclxuICAgICAgICAgICAgY2FzZSAzODpcclxuICAgICAgICAgICAgICAgIHNjcm9sbGVyLnByZXYoKTtcclxuICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgXHJcbiAgICAgICAgICAgIGNhc2UgNDA6XHJcbiAgICAgICAgICAgICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgIH1cclxuICAgIFxyXG59KTtcclxuXHJcblxyXG5cclxuJChcIi53cmFwcGVyXCIpLm9uKFwidG91Y2htb3ZlXCIsIGUgPT4gZS5wcmV2ZW50RGVmYXVsdCgpKTtcclxuXHJcbiQoXCJbZGF0YS1zY3JvbGwtdG9dXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcblxyXG4gICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zY3JvbGwtdG9cIik7XHJcbiAgICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pZD0ke3RhcmdldH1dYCk7XHJcblxyXG4gICAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxufSk7XHJcblxyXG5cclxuXHJcbmlmIChpc01vYmlsZSkge1xyXG4gICAgLy9odHRwczovL2dpdGh1Yi5jb20vbWF0dGJyeXNvbi9Ub3VjaFN3aXBlLUpxdWVyeS1QbHVnaW5cclxuICAgICQoXCJib2R5XCIpLnN3aXBlKHtcclxuICAgICAgICBzd2lwZTogZnVuY3Rpb24gKGV2ZW50LCBkaXJlY3Rpb24pIHtcclxuICAgICAgICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbiAgICAgICAgICAgIGxldCBzY3JvbGxEaXJlY3Rpb24gPSBcIlwiO1xyXG5cclxuICAgICAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJ1cFwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcIm5leHRcIjtcclxuICAgICAgICAgICAgaWYoZGlyZWN0aW9uID09PSBcImRvd25cIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJwcmV2XCI7XHJcblxyXG4gICAgICAgICAgICBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7XHJcbiAgICAgICAgfSxcclxuICAgIH0pO1xyXG59XHJcblxyXG59KSgpXHJcblxyXG5cclxuXHJcblxyXG5cclxuICBcclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwiKGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3QgcGxheUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy52aWRlb19fcGxheWVyLWltZycpO1xyXG4gICAgY29uc3QgdmlkZW8gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGxheWVyJyk7XHJcbiAgICBjb25zdCBwbGF5ZXJQbGF5QnJuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLmR1cmF0aW9uX19pbWcnKTtcclxuICAgIGNvbnN0IGR1cmF0aW9uQ29udHJvbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkdXJhdGlvbkxldmVsJyk7XHJcbiAgICBjb25zdCBzb3VuZENvbnRyb2wgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbWljTGV2ZWwnKTtcclxuICAgIGNvbnN0IHNvdW5kQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3NvdW5kQnRuJyk7XHJcbiAgICBjb25zdCBkeW5hbWljQnRuID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2R5bmFtaWMnKTtcclxuICAgIFxyXG4gICAgbGV0IGludGVydmFsSWQ7IFxyXG4gICAgbGV0IHNvdW5kTGV2ZWw7XHJcbiAgICBcclxuICAgIC8vIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoXCJsb2FkZWRkYXRhXCIsIGZ1bmN0aW9uICgpIHtcclxuICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWQnLCBmdW5jdGlvbigpIHtcclxuICAgIFxyXG4gICAgdmlkZW8uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBwbGF5U3RvcCk7IFxyXG4gICAgbGV0IHBsYXlCdXR0b25zID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnBsYXknKTtcclxuICAgIFxyXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBwbGF5QnV0dG9ucy5sZW5ndGg7IGkrKykge1xyXG4gICAgICBwbGF5QnV0dG9uc1tpXS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHBsYXlTdG9wKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZHVyYXRpb25Db250cm9sLm1pbiA9IDA7XHJcbiAgICBkdXJhdGlvbkNvbnRyb2wudmFsdWUgPSAwO1xyXG4gICAgZHVyYXRpb25Db250cm9sLm1heCA9IHZpZGVvLmR1cmF0aW9uO1xyXG4gICAgZHVyYXRpb25Db250cm9sLmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0Jywgc2V0VmlkZW9EdXJhdGlvbik7XHJcbiAgICBcclxuICAgIHNvdW5kQ29udHJvbC5taW4gPSAwO1xyXG4gICAgc291bmRDb250cm9sLm1heCA9IDEwO1xyXG4gICAgc291bmRDb250cm9sLnZhbHVlID0gc291bmRDb250cm9sLm1heDtcclxuICAgIHNvdW5kQ29udHJvbC5hZGRFdmVudExpc3RlbmVyKCdpbnB1dCcsIGNoYW5nZVNvdW5kVm9sdW1lKTtcclxuICAgIFxyXG4gICAgZHluYW1pY0J0bi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHNvdW5kT2YpO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIHZpZGVvLmFkZEV2ZW50TGlzdGVuZXIoJ2VuZGVkJywgKCkgPT4ge1xyXG4gICAgICBwbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoJ3ZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmUnKTtcclxuICAgICAgcGxheWVyUGxheUJybi5jbGFzc0xpc3QucmVtb3ZlKCdkdXJhdGlvbl9faW1nLXBhdXNlJyk7XHJcbiAgICAgIHZpZGVvLmN1cnJlbnRUaW1lID0gMDtcclxuICAgIH0pXHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHBsYXlTdG9wKCkge1xyXG4gICAgICBwbGF5QnRuLmNsYXNzTGlzdC50b2dnbGUoJ3ZpZGVvX19wbGF5ZXItaW1nLS1hY3RpdmUnKTtcclxuICAgICAgcGxheWVyUGxheUJybi5jbGFzc0xpc3QudG9nZ2xlKCdkdXJhdGlvbl9faW1nLXBhdXNlJyk7XHJcbiAgICAgIGlmICh2aWRlby5wYXVzZWQpIHtcclxuICAgICAgICB2aWRlby5wbGF5KCk7XHJcbiAgICAgICAgaW50ZXJ2YWxJZCA9IHNldEludGVydmFsKHVwZGF0ZUR1cmF0aW9uLCAxMDAwIC8gNjApO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWxJZCk7XHJcbiAgICAgICAgdmlkZW8ucGF1c2UoKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgXHJcbiAgICBmdW5jdGlvbiBzZXRWaWRlb0R1cmF0aW9uKCkge1xyXG4gICAgICB2aWRlby5jdXJyZW50VGltZSA9IGR1cmF0aW9uQ29udHJvbC52YWx1ZTtcclxuICAgICAgdXBkYXRlRHVyYXRpb24oKTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gdXBkYXRlRHVyYXRpb24oKSB7XHJcbiAgICAgIGR1cmF0aW9uQ29udHJvbC52YWx1ZSA9IHZpZGVvLmN1cnJlbnRUaW1lO1xyXG4gICAgICBsZXQgc3RlcCA9IHZpZGVvLmR1cmF0aW9uIC8gMTAwO1xyXG4gICAgICBsZXQgcGVyY2VudCA9IHZpZGVvLmN1cnJlbnRUaW1lIC8gc3RlcDtcclxuICAgICAgZHVyYXRpb25Db250cm9sLnN0eWxlLmJhY2tncm91bmQgPSBgbGluZWFyLWdyYWRpZW50KDkwZGVnLCAjRkVEQjNGIDAlLCAjRkVEQjNGICR7cGVyY2VudH0lLCAjNjI2MjYyICR7cGVyY2VudH0lKWA7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGNoYW5nZVNvdW5kVm9sdW1lKCkge1xyXG4gICAgICB2aWRlby52b2x1bWUgPSBzb3VuZENvbnRyb2wudmFsdWUgLyAxMDtcclxuICAgICAgaWYgKHZpZGVvLnZvbHVtZSA9PT0gMCkge1xyXG4gICAgICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5hZGQoJ2FjdGl2ZScpO1xyXG4gICAgICB9IGVsc2Uge1xyXG4gICAgICAgIHNvdW5kQnRuLmNsYXNzTGlzdC5yZW1vdmUoJ2FjdGl2ZScpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIHNvdW5kT2YoKSB7XHJcbiAgICAgIGlmICh2aWRlby52b2x1bWUgPT09IDApIHtcclxuICAgICAgICB2aWRlby52b2x1bWUgPSBzb3VuZExldmVsO1xyXG4gICAgICAgIHNvdW5kQ29udHJvbC52YWx1ZSA9IHNvdW5kTGV2ZWwgKiAxMDtcclxuICAgICAgICBzb3VuZEJ0bi5jbGFzc0xpc3QucmVtb3ZlKCdhY3RpdmUnKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzb3VuZExldmVsID0gdmlkZW8udm9sdW1lO1xyXG4gICAgICAgIHZpZGVvLnZvbHVtZSA9IDA7XHJcbiAgICAgICAgc291bmRDb250cm9sLnZhbHVlID0gMDtcclxuICAgICAgICBzb3VuZEJ0bi5jbGFzc0xpc3QuYWRkKCdhY3RpdmUnKTtcclxuICAgICAgfVxyXG4gICAgfVxyXG4gICAgfSkoKSIsIlxyXG4oZnVuY3Rpb24oKXtcclxuXHJcbmNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICByZXR1cm4gJChcIi5yZXZpZXdzX19pdGVtXCIpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XHJcbiAgICByZXR1cm4gJChpdGVtKS5hdHRyKFwiZGF0YS1zZWxlY3RlZFwiKSA9PT0gYWxpYXM7IFxyXG4gIH0pO1xyXG59O1xyXG5cclxuJChcIi5yZXZpZXdzX19zd2l0Y2hlci1saW5rXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICBjb25zdCB0YXJnZXQgPSAkdGhpcy5hdHRyKFwiZGF0YS1zZWxlY3RcIik7XHJcbiAgY29uc3QgaXRlbVNob3cgPSBmaW5kQmxvY2tCeUFsaWFzKHRhcmdldCk7XHJcbiAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIucmV2aWV3c19fc3dpdGNoZXItaXRlbVwiKTtcclxuXHJcbiAgaXRlbVNob3cuYWRkQ2xhc3MoXCJyZXZpZXdzX19pdGVtLS1hY3RpdmVcIikuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhcInJldmlld3NfX2l0ZW0tLWFjdGl2ZVwiKTtcclxuICBjdXJJdGVtLmFkZENsYXNzKFwicmV2aWV3c19fc3dpdGNoZXItaXRlbS0tYWN0aXZlXCIpLnNpYmxpbmdzKCkucmVtb3ZlQ2xhc3MoXCJyZXZpZXdzX19zd2l0Y2hlci1pdGVtLS1hY3RpdmVcIik7XHJcbn0pO1xyXG5cclxuXHJcbn0pKCkiLCIvLyDQv9GA0L7RgdGC0L7QuSDRgdC/0L7RgdC+0LFcclxuKGZ1bmN0aW9uKCl7IFxyXG5sZXQgYnVyZ2VyICA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5idXJnZXInKTtcclxubGV0IG92ZXJsYXkgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcub3ZlcmxheScpO1xyXG5sZXQgYm9keSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJ2JvZHknKTtcclxuXHJcbmxldCBsaW5rcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5vdmVybGF5IC5tZW51X19saW5rJyk7IFsxLDIsMyw0LDUsNiw3XVxyXG5cclxubGlua3MuZm9yRWFjaChmdW5jdGlvbihlbGVtZW50KXtcclxuICBlbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJyAsIHRvZ2dsZU1lbnUpO1xyXG59KVxyXG5cclxuZnVuY3Rpb24gdG9nZ2xlTWVudSgpe1xyXG4gIGJ1cmdlci5jbGFzc0xpc3QudG9nZ2xlKCdidXJnZXItLWFjdGl2ZScpO1xyXG4gIG92ZXJsYXkuY2xhc3NMaXN0LnRvZ2dsZSgnb3ZlcmxheS0tYWN0aXZlJyk7XHJcbiAgYm9keS5jbGFzc0xpc3QudG9nZ2xlKCdib2R5LS1hY3RpdmUtbWVudScpO1xyXG59XHJcblxyXG5idXJnZXIuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snICwgdG9nZ2xlTWVudSk7XHJcblxyXG5cclxufSkoKVxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuXHJcblxyXG5cclxuIiwiXHJcbjsoZnVuY3Rpb24oKXtcclxuJChkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24oKXtcclxuICBjb25zdCBzbGlkZXIgPSAkKFwiLnNsaWRlcl9fbGlzdFwiKS5ieFNsaWRlcih7XHJcbiAgICBwYWdlcjogZmFsc2UsXHJcbiAgICBjb250cm9sczogZmFsc2UsXHJcbiAgfSk7XHJcblxyXG4gICQoJy5wcm9kdWN0c19fYXJyb3ctLXByZXYnKS5jbGljayhlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuXHJcbiAgICBzbGlkZXIuZ29Ub1ByZXZTbGlkZSgpO1xyXG4gIH0pXHJcbiAgJCgnLnByb2R1Y3RzX19hcnJvdy0tbmV4dCcpLmNsaWNrKGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cclxuICAgIHNsaWRlci5nb1RvTmV4dFNsaWRlKCk7XHJcbiAgfSlcclxufSk7XHJcblxyXG5cclxufSkoKVxyXG5cdCIsIihmdW5jdGlvbigpeyBjb25zdCBvcGVuSXRlbSA9IGl0ZW0gPT4ge1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLnRlYW1fX2l0ZW1cIik7XHJcbiAgICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xyXG4gICAgY29uc3QgdGV4dEJsb2NrID0gY29udGVudEJsb2NrLmZpbmQoXCIudGVhbV9fY29udGVudC1ibG9ja1wiKTtcclxuICAgIGNvbnN0IHJlcUhlaWdodCA9IHRleHRCbG9jay5oZWlnaHQoKTtcclxuICBcclxuICAgIGNvbnRhaW5lci5hZGRDbGFzcyhcInRlYW1fX2l0ZW0tLWFjdGl2ZVwiKTtcclxuICAgIGNvbnRlbnRCbG9jay5oZWlnaHQocmVxSGVpZ2h0KTtcclxuICB9XHJcbiAgXHJcbiAgXHJcbiAgY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSAoY29udGFpbmVyKSA9PiB7XHJcbiAgICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKCcudGVhbV9fY29udGVudCcpO1xyXG4gICAgY29uc3QgaXRlbUNvbnRhaW5lciA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2l0ZW1cIik7XHJcbiAgXHJcbiAgICBpdGVtQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwidGVhbV9faXRlbS0tYWN0aXZlXCIpO1xyXG4gICAgaXRlbXMuaGVpZ2h0KDApO1xyXG4gIH1cclxuICBcclxuICAkKCcudGVhbV9fdGl0bGUnKS5jbGljayhlID0+IHtcclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gJHRoaXMuY2xvc2VzdCgnLnRlYW0nKTtcclxuICAgIGNvbnN0IGVsZW1Db250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLnRlYW1fX2l0ZW1cIik7XHJcbiAgXHJcbiAgICBpZihlbGVtQ29udGFpbmVyLmhhc0NsYXNzKFwidGVhbV9faXRlbS0tYWN0aXZlXCIpKSB7XHJcbiAgICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgY2xvc2VFdmVyeUl0ZW0oY29udGFpbmVyKTtcclxuICAgICAgb3Blbkl0ZW0oJHRoaXMpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIFxyXG4gIFxyXG4gIFxyXG4gIFxyXG4gIC8vIGNvbnN0IHRyaWFuZ2xlUG9zaXRpb24gKClcclxuICAgICAgXHJcbiAgICAgIFxyXG4gICQoJy50ZWFtX190aXRsZScpLm9uKCdjbGljaycsIGUgPT57XHJcbiAgICAgIFxyXG4gICAgY29uc3QgY2hvc2VuRWxlbSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IGl0ZW1TdG9yZSA9IGNob3NlbkVsZW0uY2xvc2VzdCgnLnRlYW0nKTtcclxuICAgIGNvbnN0IGVsZW1TdG9yZSA9IGNob3NlbkVsZW0uY2xvc2VzdCgnLnRlYW1fX2l0ZW0nKTtcclxuICAgIGNvbnN0IHRyaWFuZ2xlID0gY2hvc2VuRWxlbS5maW5kKCcudGVhbV9fdGl0bGUtc3ZnLXBhdGgnKTtcclxuICAgIGNvbnN0IHRyaWFuZ2xlQWxsID0gaXRlbVN0b3JlLmZpbmQoJy50ZWFtX190aXRsZS1zdmctcGF0aCcpO1xyXG4gIFxyXG4gIFxyXG4gIFxyXG4gICAgaWYoZWxlbVN0b3JlLmhhc0NsYXNzKCd0ZWFtX19pdGVtLWFjdGl2ZScpKXtcclxuICAgICAgY2xvc2VJdGVtKGl0ZW1TdG9yZSk7XHJcbiAgICAgIHRyaWFuZ2xlLmF0dHIoJ3hsaW5rOmhyZWYnLCAnLi9pbWcvaWNvbnMvc3ByaXRlLnN2ZyN0ZWFtLXRyaWFuZ2xlJylcclxuICAgIH0gZWxzZXtcclxuICAgICAgY2xvc2VJdGVtKGl0ZW1TdG9yZSk7XHJcbiAgICAgIG9wZW5JdGVtKGNob3NlbkVsZW0pO1xyXG4gICAgICB0cmlhbmdsZUFsbC5hdHRyKCd4bGluazpocmVmJywgJy4vaW1nL2ljb25zL3Nwcml0ZS5zdmcjdGVhbS10cmlhbmdsZScpO1xyXG4gICAgICB0cmlhbmdsZS5hdHRyKCd4bGluazpocmVmJywgJy4vaW1nL2ljb25zL3Nwcml0ZS5zdmcjdHJpYW5nbGUtdXAnKTtcclxuICBcclxuICAgIH1cclxuICB9KTtcclxuXHJcbn0pKCkiXX0=
